elasticsearch:
  build: images/elasticsearch

nginx:
  build: images/nginx
  command: nginx -c /etc/nginx/nginx.conf -g "daemon off;"
  links:
    - webpay
    - spartacus
    - solitude
    - zamboni
  ports:
    - '80:80'
  volumes:
    - trees/spartacus/public/:/srv/spartacus

memcached:
  build: images/memcached
  command: service memcached start

mysqldata:
  build: images/mysql-data

mysql:
  build: images/mysql-service
  volumes_from:
    - mysqldata

solitude:
  build: trees/solitude
  command: /bin/bash /srv/solitude/bin/docker_run.sh
  links:
    - mysql
  volumes:
    - trees/solitude/:/srv/solitude
  working_dir: /srv/solitude

spartacus:
  build: trees/spartacus
  command: "grunt docker"
  volumes:
    - trees/spartacus/:/srv/spartacus/src
  working_dir: /srv/spartacus/src

webpay:
  build: trees/webpay
  command: python manage.py runserver 0.0.0.0:2601
  volumes:
    - trees/webpay/:/srv/webpay
  working_dir: /srv/webpay

zamboni:
  build: trees/zamboni
  command: /bin/bash /srv/zamboni/bin/docker_run.sh
  links:
    - mysql
    - memcached
  volumes:
    - trees/zamboni/:/srv/zamboni
  working_dir: /srv/zamboni
